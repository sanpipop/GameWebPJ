var q7=' "Helvetica Neue", Helvetica, Arial, sans-serif';var c6=0;var u2={LIGHT:{road:"#3a3a3a",grass:"#047804",w0:"#a02222",lane:"#CCCCCC"},DARK:{road:"#3a3a3a",grass:"#006A00",w0:"#BBBBBB"},START:{road:"white",grass:"#009A00",w0:"#BBBBBB"},FINISH:{road:"black",grass:"black",w0:"black"}};var cntx=null;function j7(t,i){cntx.clearRect(0,0,t,i)}function g1(t){cntx.globalAlpha=t}function m2(t,i,a,r){cntx.fillRect(t,i,a,r)}function a6(t,i,a,r){return cntx.createLinearGradient(t,i,a,r)}function g0(t){cntx.strokeStyle=t}function p2(){cntx.stroke()}function k4(t){cntx.fillStyle=t}function k3(){cntx.beginPath()}function p0(t,i){cntx.moveTo(t,i)}function t9(t,i,a,r,e,s){cntx.arc(t,i,a,r,e,s)}function o9(t,i){cntx.lineTo(t,i)}function k0(){cntx.closePath()}function s2(){cntx.fill()}function l2(t,i,a){cntx.fillText(t,i,a)}function s3(){cntx.save()}function n0(){cntx.restore()}function j4(t,i){cntx.translate(t,i)}function q1(t){cntx.rotate(t)}function i5(t,i,a,r,e,s,n,h,v){cntx.drawImage(t,i,a,r,e,s,n,h,v)}var M=Math;var PI=Math.PI;function r9(){return M.random()}function m8(t){return M.floor(r9()*t)}function sin(t){return M.sin(t)}function cos(t){return M.cos(t)}var l3=600,k6=600,l8=2400,k5=2400,b4=1280,a9=480,c2=600,b9=600,j8=l4(l3,k6),t8=l4(l8,k5);j9=t8.c,h0=t8.x,e3=l4(b4,a9),e2=l4(b4,a9),e1=l4(b4,a9),j1=l4(c2,b9),a7=a5=f1=d3=b7=d8=d0=e8=0,c8=[],q0=0;var r5="#222222";var p8="#cccccc";var q5="#e5e5e5";function k9(){j8.x.clearRect(0,0,l3,k6)}function l4(t,i){var a=document.createElement("canvas");a.width=t;a.height=i;var r=a.getContext("2d");return{c:a,x:r}}var p1=0;var p3=0;var c1=0;function j2(){p1=0;p3=0;c1=0;h0.clearRect(0,0,l8,k5);e1.x.clearRect(0,0,b4,a9);e2.x.clearRect(0,0,b4,a9);e3.x.clearRect(0,0,b4,a9)}function e6(t,i,a,r){var e=0;k4(r);var s=a+a*r9();k3();p0(t+s*cos(e),i+s*sin(e));for(var n=1;n<30;n++){e=n*PI*2/30;s=a+a*r9();o9(t+s*cos(e),i+s*sin(e))}k0();s2()}function a8(){var t=j8.x.getImageData(0,0,j8.c.width,j8.c.height);var i=new Uint32Array(t.data.buffer);var a,r;var e=j8.c.width;var s=j8.c.height;var n=e,h=s,v=0,f=0;for(r=0;r<s;r++){for(a=0;a<e;a++){if(i[a+r*e]>0){if(a<n){n=a}if(a>v){v=a}if(r<h){h=r}if(r>f){f=r}}}}var c=f-50;if(c<0){c=0}var o=e;var u=0;for(r=c;r<f;r++){for(a=0;a<e;a++){if(i[a+r*e]>0){if(a<o){o=a}if(a>u){u=a}}}}return{x:n,y:h,w:v-n,h:f-h,cx:o-n,cw:u-o}}function q4(t){var i=t||0;var a=a8();if(p1+a.w>l8){p1=0;p3+=c1;c1=0}if(a.h>c1){c1=a.h}h0.save();var r=p1;if(i){h0.scale(-1,1);r=-p1-a.w;a.cx=a.w-a.cx-a.cw}h0.drawImage(j8.c,a.x,a.y,a.w,a.h,r,p3,a.w,a.h);h0.restore();var e={x:p1,y:p3,w:a.w,h:a.h,cx:a.cx,cw:a.cw};p1+=a.w+5;return e}function e5(){cntx=j8.x;k9();k4("#996644");m2(0,0,200,200);k4("#996644");m2(10,200,10,10);k4("#996644");m2(180,200,10,10);k4(p8);m2(10,10,180,180);k3();p0(20,100);o9(160,30);o9(160,170);o9(20,100);k4("#cc2211");s2();k4(p8);m2(10,10,20,180);d8=q4();d0=q4(1)}function r0(t,i){var a=[];var r=0;var e=0;a[e++]=0;var s=1;for(var n=0;n<t;n++){r=r+r9()*i;a[e++]=r}while(r>0){r=r-r9()*i;a[e++]=r}return a}function b1(){cntx=e1.x;var t=["#114433","#114e33","#115433","#113433","#114433"];var i=0;for(var a=0;a<4;a++){var r=i;var e=10+40*r9();for(var s=0;s<e;s++){var n=r0(8,7);var h=m8(t.length);k4(t[h]);k3();p0(r,240-n[0]);for(var v=1;v<n.length;v++){o9(r+v,240-n[v])}k0();s2();r+=2+r9()*4}var t=["#226639","#115e33","#316433","#215433","#114433"];var r=i;for(var s=0;s<e;s++){var n=r0(4,4);var h=m8(t.length);k4(t[h]);k3();p0(r,240-n[0]);for(var v=1;v<n.length;v++){o9(r+v,240-n[v])}k0();s2();r+=2+r9()*5}i=r+50+r9()*180}}function t5(t){cntx=e2.x;var i=[];var a=[];var r=[];var e=[];var s=0;var n=0;var h=1;h=.1+3*r9();var v=20*100*r9();for(var f=0;f<100;f++){s=s+r9()*h;i[n]=s;a[n]=s;n++;h+=.01}var v=5+8*r9();for(var f=0;f<v;f++){s=s+(.4-r9())*2;a[n]=s;i[n++]=s}var c=[];var o=s;while(o>0){o-=r9()*5;c.push(o)}if(r9()>.6){v=160*r9()}else{v=20*r9()}for(var f=0;f<v;f++){s=s+(.4-r9())*2;i[n++]=s}while(s>0){s=s-r9()*h;i[n++]=s;h-=.003;if(h<0){h=.03}}for(var f=0;f<a.length-20;f++){o=a[f]+r9();r.push(o)}for(var f=0;f<r.length-10;f++){o-=r9()*2;e.push(o)}var u=260;var l=t;k4("#114433");k3();p0(l,u-i[0]);for(var d=1;d<i.length;d++){o9(l+d,u-i[d])}k0();s2();l=t;k4("#224a33");k3();p0(l,u-a[0]);for(var d=1;d<a.length;d++){o9(l,u-a[d]);l++}for(var d=1;d<c.length;d++){o9(l,u-c[d]);if(r9()>.4){l--}else if(r9()>.4){l++}}k0();s2();l=t+4;k4("#335a3a");k3();p0(l,u-r[0]);for(var d=1;d<r.length;d++){o9(l,u-r[d]);l++}for(var d=1;d<e.length;d++){o9(l,u-e[d]);if(r9()>.8){l++}else if(r9()>.1){l--}}k0();s2();return i}function a3(){var t=0;for(var i=0;i<20;i++){t5(t);t+=3+r9()*100}}var tree={o0:"",draw:function(){j4(500/2,500);this.o0="#"+(16777216+r9()*16777215).toString(16).substr(1,6);cntx.lineWidth=1+r9()*20;cntx.lineJoin="round";this.u5(0)},u5:function(t){if(t<12){k3();p0(0,0);o9(0,-500/10);p2();j4(0,-500/10);var i=-(r9()*.1)+.1;q1(i);if(r9()*1<.6){q1(-.35);cntx.scale(.7,.7);s3();this.u5(t+1);n0();q1(.6);s3();this.u5(t+1);n0()}else{this.u5(t)}}else{k4(this.o0);m2(0,0,500,200);p2()}}};var k1=[];function createTrees(){k1=[];for(var t=0;t<6;t++){var i=.6;var a=false;var r=0;while(!a){cntx=j8.x;j8.x.save();k9();tree.draw();var e=a8();a=e.w<300&&e.h<400||r>5;j8.x.restore();r++}k1[t]=q4()}}function c0(t,i,a,r){cntx=e1.x;var e=30;var s=20;var n=2;var h=1;var v=1;var f=4;var c=8;if(i==1){h=2;v=2;f=3;c=10;e=40;s=25}if(i==2){h=4;f=2;c=6;e=20;s=18}var o=260;e+=30*r9();k4(a);m2(t,o-e,s,e);if(r9()<.4){var u=5;var l=8;m2(t+u,o-(e+l),s-2*u,e+l)}if(r9()<.2){var u=5;var l=13;var d=2;m2(t+u,o-(e+l),d,e+l)}for(var p=0;p<c;p++){var x=n+p*(v+n);for(var g=0;g<f;g++){var m=n+g*(h+n);k4(r);m2(t+m,o-e+x,h,v)}}}function a4(t){var i="#777799";var a="#9999ee";if(t){i="#060606";a="#929156"}var r=0;for(var e=0;e<80;e++){var s=r9();if(s<.4){c0(r,0,i,a)}else if(s<.6){c0(r,1,i,a)}else{c0(r,2,i,a)}r+=10+r9()*30}var i="#9999aa";var a="#aaaaee";if(t){i="#101010";a="#929156"}var r=0;for(var e=0;e<80;e++){var s=r9();if(s<.4){c0(r,0,i,a)}else if(s<.6){c0(r,1,i,a)}else{c0(r,2,i,a)}r+=10+r9()*30}}function f8(t){c8=[];for(var i=0;i<4;i++){k9();cntx=j8.x;var a=100+r9()*80;if(t){a=10+r9()*20}k4("rgb("+a+","+a+","+a+")");m2(0,30,240,500);var r=24,e=15,s=8,n=8,h=10;var v=col=x=y=0;for(v=0;v<18;v++){y=30+s+v*(e+h);for(col=0;col<7;col++){x=s+col*(r+n);if(t){if(r9()>.7){k4("#ffffec");m2(x,y,r,e);k4("#bbbb88");m2(x,y+e/2,r,e/2)}else{k4("#112237");m2(x,y,r,e);k4("#111a30");m2(x,y+e/2,r,e/2)}}else{k4("#5555a7");m2(x,y,r,e);k4("#444495");m2(x,y+e/2,r,e/2)}}}c8[i]=q4()}}function c3(t){cntx=j8.x;k9();k4("#999999");if(t){k4("#555555")}var i=7;m2(40,150,i,300);k3();t9(70,150,30,PI,-PI/2);o9(70,150-30+i);t9(70,150,30-i,-PI/2,PI,true);o9(70-30,150);s2();m2(70,150-30,70,i);m2(130,150-30-1,35,6);k4("#aaaaaa");if(t){k4("#777777")}m2(40+i-4,150,2,300);m2(70,150-30+i-4,70,2);k3();t9(70,150,30-i+4,PI,-PI/2);o9(70,150-30+i);t9(70,150,30-i,-PI/2,PI,true);o9(70-30,150);s2();k4("#aaaaaa");if(t){k4("#999999")}m2(40+i-2,150,2,300);m2(70,150-30+i-2,70,2);k3();t9(70,150,30-i+2,PI,-PI/2);o9(70,150-30+i);t9(70,150,30-i,-PI/2,PI,true);o9(70-30,150);s2();if(t){cntx.filter="blur(2px)"}k4("#ffffff");m2(128,150-30+4,38,12);if(t){g1(.8);cntx.globalCompositeOperation="lighter";cntx.filter="blur(4px)";m2(123,150-30+3,44,18);g1(1)}cntx.filter=null;a7=q4();a5=q4(1)}function i0(){var t=b4;var i=a9;cntx=e3.x;var a=a6(0,0,0,i);a.addColorStop(0,"#00111e");a.addColorStop(1,"#033d5e");k4(a);m2(0,0,b4,a9);var r=Math.round(t+i);for(var e=0;e<=r;e++){var s=m8(t);var n=m8(i);var h=m8(2)+1;var v=m8(9)+1;var f=m8(9)+1;var c=m8(360);if(h>1){cntx.shadowBlur=m8(15)+5;cntx.shadowColor="white"}k4("hsla("+c+", 30%, 80%, ."+v+f+")");m2(s,n,h,h)}}function createLeaf(t){k4(t);k3();t9(3,7,3,PI/2,PI);t9(10,7,10,PI,PI*1.24);t9(-4.7,7,10,PI*1.76,0);t9(2.3,7,3,0,PI/2);s2()}function j5(){k9();cntx=j8.x;var t=j8.c;cntx.save();var i=a6(0,0,0,8);i.addColorStop(0,"#ff111e");i.addColorStop(1,"#aa3d5e");createLeaf(i);cntx.translate(0,20);createLeaf(i);cntx.translate(0,20);createLeaf(i);cntx.translate(0,20);createLeaf("#44aa55");cntx.restore();var a=100;for(var r=0;r<2;r++){var e=30;for(var s=0;s<60;s++){e+=4+6*r9();if(e>780){continue}var n=20+4*r9();a=100+r*16-n+r9()*12;if(r9()>.5){k4("#44aa55");m2(e,a,2,n);k4("#66cc88");m2(e,a,1,n)}else{k4("#449955");m2(e,a,2,n);k4("#66aa88");m2(e,a,1,n)}var h=m8(2)*20;var v=e-2;var f=a-6;s3();j4(v+3,f);q1(.3);i5(t,0,h,6,11,0,0,6,11);n0();s3();j4(v-3,f+1);q1(-.3);i5(t,0,h,6,11,0,0,6,11);n0();s3();j4(v,f);i5(t,0,h,6,11,0,0,6,11);n0();s3();j4(v+6,f+10);q1(.6);i5(t,0,60,6,11,0,0,6,11);n0()}}cntx.clearRect(0,0,22,300);e8=q4()}function o7(t,i){k3();k4(i);p0(t[0],t[1]);for(var a=2;a<t.length;a+=2){o9(t[a],t[a+1])}k0();s2()}function drawLine(t,i,a,r){k3();p0(t,i);o9(a,r);cntx.stroke()}function r2(){k9();cntx=j8.x;var t=[8,194,11,206,14,214,18,216,41,215,46,213,47,205];o7(t,r5);var t=[227,193,230,200,241,204,258,203,265,197,268,191];o7(t,r5);var t=[5,192,25,206,296,190,302,164,298,149,296,145,292,111,289,103,294,101,294,91,297,84,263,72,208,14,167,2,66,3,45,7,8,55,5,65,7,88,2,97,1,151];o7(t,"#a9fb78");var t=[25,206,296,190,302,164,298,149,296,145,292,111,289,103,294,101,294,91,297,84,17,93,22,122,20,162,20,170,2,145,3,160,6,187];o7(t,"#4abf74");var t=[20,108,294,96,296,89,19,98];o7(t,"#226d7d");var t=[21,162,296,149,292,112,22,122];o7(t,"#226d7d");var t=[42,86,260,79,208,21,60,24];var i=a6(0,19,0,90);i.addColorStop(0,"#4fa8f7");i.addColorStop(1,"#2d3c7c");o7(t,i);t=[51,62,238,57,253,76,196,67,159,64,125,66,81,72,45,82];o7(t,"#95eef7");var t=[27,83,33,77,46,27,21,70];o7(t,"#4773dd");var t=[19,61,46,17,43,12,19,51];o7(t,"#4773dd");var t=[3,99,10,113,18,120,17,106,11,86,5,91];o7(t,"#ffd47e");var t=[21,127,19,145,20,158,106,153,105,124];o7(t,"#b44258");var t=[20,158,106,153,105,142,19,146];o7(t,"#5d2959");var t=[217,120,218,149,296,145,296,134,293,116];o7(t,"#b44258");var t=[218,149,296,145,296,133,218,137];o7(t,"#5d2959");var t=[21,173,300,159,299,149,21,162];o7(t,"#a9fb78");f1=q4(0);d3=q4(1)}function p6(){k9();cntx=j8.x;var t=j8.c;var i=[5,197,143,197,141,87,1,87,4,106,1,121,1,180];o7(i,"#4abf74");var i=[141,87,143,1,87,3,72,6,61,17,31,67,1,87];o7(i,"#a9fb78");i=[4,100,143,100,143,93,3,93];o7(i,"#226d7d");i=[4,155,143,155,143,113,4,113];o7(i,"#226d7d");i=[4,150,86,149,86,121,5,121,3,139];o7(i,"#b44258");i=[4,149,86,149,86,138,4,138];o7(i,"#5d2959");i=[22,131,22,134,73,134,73,131];o7(i,"#d65d5b");i=[32,82,143,82,143,19,66,19];var a=a6(0,19,0,90);a.addColorStop(0,"#4fa8f7");a.addColorStop(1,"#2d3c7c");o7(i,a);i=[47,59,143,59,143,64,78,68,38,77];o7(i,"#95eef7");i=[13,197,16,205,23,208,49,207,56,202,58,197];o7(i,r5);var i=[1,155,1,167,143,167,143,155];o7(i,"#a9fb78");s3();cntx.scale(-1,1);i5(j8.c,0,0,143,210,-143-132,0,143,210);n0();b7=q4(0)}function o6(){r2();p6()}function b2(t,i){return t%i/i}function g4(t,i,a){return t+(i-t)*a}function l1(t,i,a){var r=t+i;while(r>=a)r-=a;while(r<0)r+=a;return r}var m5=function(t,i){this.canvas=t;this.t2=i};m5.prototype={init:function(){v0.reset();v5.buildv30()},keyDown:function(t){if(t.keyCode===88){startGame()}},keyUp:function(t){},p5:function(){n2=true;var t=height;v0.y=400;v0.depth=.83909963117728;v0.x=0;var i=v5.n1(v0.z);var a=b2(v0.z,v3.t4Length);v0.y=500+g4(i.p1.v4.y,i.p3.v4.y,a);var r,e,s,n,h,v,f,c;var o=0;for(r=0;r<v0.l5;r++){s=v5.o8((i.index+r)%v5.o8Count());s.u9=s.index<i.index;s.clip=t;s.clip=0;v0.t7(s.p1,0,s.u9,width,height,q8);v0.t7(s.p2,0,s.u9,width,height,q8);v0.t7(s.p3,0,s.u9,width,height,q8);v0.t7(s.p4,0,s.u9,width,height,q8);if(s.p1.v0.z<=v0.depth||s.p3.u1.y>=s.p1.u1.y||s.p3.u1.y>=t)continue;k2(s);t=s.p1.u1.y}},render:function(t){cntx=this.t2;var i=l6();k4(r5);m2(0,0,this.canvas.width,this.canvas.height);for(var a=0;a<30;a++){var r=100+a*10;t2.font="italic "+r+"px "+q7;t2.fontStyle="italic";var e=80+a*4;e=(e+i/6)%200;if(a==29){e=255}k4("rgb("+e+","+e+","+e+")");l2("racer",400-a*11,300-a)}t2.font="44px "+q7;l2("Arrow keys to drive, z for Turbo, x for Handbreak",38,570);l2("x To Start",423,460);v0.z=l1(v0.z,t*120,v5.r1());this.p5()}};var u3=function(){this.fieldOfView=100;this.y=0;this.z=0;this.l5=300;this.depth=0;this.fogDensity=25;this.t6=0;this.u0=740;this.t6=700};u3.prototype={reset:function(){this.depth=1/Math.tan(this.fieldOfView/2*Math.PI/180);this.u0=740;this.t6=700},t7:function(t,i,a,r,e){var s=this.z;if(a){s-=v5.r1()}var n=this.x+i;t.v0.x=(t.v4.x||0)-n;t.v0.y=(t.v4.y||0)-this.y;t.v0.z=(t.v4.z||0)-s;t.u1.scale=this.depth/t.v0.z;t.u1.x=Math.round(r/2+t.u1.scale*t.v0.x*r/2);t.u1.y=Math.round(e/2-t.u1.scale*t.v0.y*e/2)},update:function(t){this.z=cars[0].z-this.t6;if(this.z<0){this.z+=v5.r1()}v0.x=cars[0].x+cars[0].width/2;var i=v5.n1(cars[0].z);var a=b2(cars[0].z,v3.t4Length);this.y=this.u0+g4(i.p1.v4.y,i.p3.v4.y,a)}};var width=1024;var height=768;var resolution=height/480;var i2=.001;var i3=.002;var i4=.003;var h3=0;var h4=0;var h6=0;var n2=false;var lastDriftDraw=0;function j6(t,i,a,r,e,s,n,h,v){var f=t2;k4(v);k3();p0(t,i);o9(a,r);o9(e,s);o9(n,h);k0();if(n2){g0(p8);p2()}else{s2()}}function k2(t){var i,a,r,e,s;var n=Math.floor(t.index/2)%2;var h=e4;var v=d4;if(n){h=g2;v=g3}if(!n2){k4(v);m2(0,t.p3.u1.y,width,t.p1.u1.y-t.p3.u1.y)}var f=t.r3*t.p1.u1.scale*width/2;var c=t.r3*t.p4.u1.scale*width/2;j6(t.p1.u1.x-f,t.p1.u1.y,t.p1.u1.x,t.p1.u1.y,t.p4.u1.x,t.p4.u1.y,t.p4.u1.x-c,t.p4.u1.y,h);j6(t.p2.u1.x,t.p2.u1.y,t.p2.u1.x+f,t.p2.u1.y,t.p3.u1.x+c,t.p3.u1.y,t.p3.u1.x,t.p3.u1.y,h);if(!n2){var o=n9;if(t.index==0){o=p8}j6(t.p1.u1.x,t.p1.u1.y,t.p2.u1.x,t.p2.u1.y,t.p3.u1.x,t.p3.u1.y,t.p4.u1.x,t.p4.u1.y,o)}var u=50*t.p1.u1.scale*width/2;var l=50*t.p4.u1.scale*width/2;r=t.p1.u1.x+100*t.p1.u1.scale*width/2;e=t.p4.u1.x+100*t.p4.u1.scale*width/2;j6(r-u/2,t.p1.u1.y,r+u/2,t.p1.u1.y,e+l/2,t.p3.u1.y,e-l/2,t.p3.u1.y,c6);r=t.p2.u1.x-100*t.p1.u1.scale*width/2;e=t.p3.u1.x-100*t.p4.u1.scale*width/2;j6(r-u/2,t.p1.u1.y,r+u/2,t.p1.u1.y,e+l/2,t.p3.u1.y,e-l/2,t.p3.u1.y,c6);lanes=2;if(n){i=(t.p2.u1.x-t.p1.u1.x)/lanes;a=(t.p3.u1.x-t.p4.u1.x)/lanes;r=t.p1.u1.x+i;e=t.p4.u1.x+a;for(s=1;s<lanes;r+=i,e+=a,s++){j6(r-u/2,t.p1.u1.y,r+u/2,t.p1.u1.y,e+l/2,t.p3.u1.y,e-l/2,t.p3.u1.y,c6)}}if(q0!=0){q3(0,t.p1.u1.y,width,t.p3.u1.y-t.p1.u1.y,t.fog)}}function e0(t,i,a,r,e){r=r||0;e=e||0;var s=b4/2;var n=a9;var h=Math.floor(b4*r);var v=0;var f=Math.min(s,b4-h);var c=n;var o=0;var u=e;var l=Math.floor(i*(f/s));var d=a;t2.drawImage(t.c,h,v,f,c,o,u,l,d);if(f<s)t2.drawImage(t.c,0,v,s-f,c,l-1,u,i-l,d)}function k8(t,i,a,r,e,s){var n=t.w*i*width/2;var h=t.h*i*width/2;r=r-h;var v=e?Math.max(0,r+h-e):0;if(v<h){t2.drawImage(j9,t.x,t.y,t.w,t.h-t.h*v/h,a,r,n,h-v);if(s!==false&&q0!=0){q3(a,r,n,h,s)}}}function b3(t,i){return 1/Math.pow(Math.E,t*t*i)}function k7(t,i,a,r,e,s){var n;if(r<0){n=f1}else if(r>0){n=d3}else{n=b7}var h=u4.width*t/n.w;var v,f;if(u4.h2>0||u4.p9>0){cars[0].b6();var c=0;if(u4.h2<=0){c=u4.p9;while(c>1){c-=1}}g1(1-c);for(v=0;v<cars[0].f2.length;v++){var o=cars[0].f2[v];k3();p0(o[0].u1.x,o[0].u1.y);for(f=1;f<o.length;f++){o9(o[f].u1.x,o[f].u1.y)}k4(p8);s2()}g1(1)}k8(n,h,i,a+u4.u7,false);if(u4.m7>0){var u=l6();if(u-lastDriftDraw>100){g1(.8);k4(p8);var l=i+12;var d=a-4;m2(l,d,50,10);l=i+260;m2(l,d,50,10);g1(1);lastDriftDraw=u}}if(u4.v7){var p=i+82;var x=a-10;e6(p,x,10,"#dd9925");e6(p,x,5,"#cccc55");p=i+230;e6(p,x,10,"#dd9925");e6(p,x,5,"#cccc55")}}function q3(t,i,a,r,e){if(e<1){g1(1-e);k4(q0);m2(t,i,a,r);g1(1)}}function l9(){cntx=t2;var t=v5.n1(v0.z);var i=b2(v0.z,v3.t4Length);var a=v5.n1(u4.z);var r=b2(u4.z,v3.t4Length);var e=g4(a.p1.v4.y,a.p3.v4.y,r);var s=height;var n=0;var h=-(t.v6*i);t2.fillStyle="#4576aa";m2(0,0,width,height);e0(e3,width,height,h3,resolution*i2*e);e0(e2,width,height,h4,resolution*i3*e);e0(e1,width,height,h6,resolution*i4*e);var v,f,c,o,u,l,d,p;for(v=0;v<v0.l5;v++){c=v5.o8((t.index+v)%v5.o8Count());c.u9=c.index<t.index;c.fog=b3(v/v0.l5,v0.fogDensity);c.clip=s;v0.t7(c.p1,-n,c.u9,width,height);v0.t7(c.p2,-n,c.u9,width,height);v0.t7(c.p3,-n-h,c.u9,width,height);v0.t7(c.p4,-n-h,c.u9,width,height);n=n+h;h=h+c.v6;if(c.p1.v0.z<=v0.depth||c.p3.u1.y>=c.p1.u1.y||c.p3.u1.y>=s)continue;k2(c);s=c.p1.u1.y}for(v=v0.l5-1;v>0;v--){c=v5.o8((t.index+v)%v5.o8Count());for(f=0;f<c.cars.length;f++){o=c.cars[f];if(o.index!==0){u=o.sprite;var x=g4(c.p1.u1.scale,c.p3.u1.scale,o.percent);d=g4((c.p1.u1.x+c.p2.u1.x)/2,(c.p3.u1.x+c.p4.u1.x)/2,o.percent)+x*o.x*width/2;p=g4(c.p1.u1.y,c.p4.u1.y,o.percent);var u=b7;l=o.width*x/u.w;if(o.s1){u=f1}else if(o.q6){u=d3}k8(u,l,d,p,c.clip,c.fog)}}for(f=0;f<c.t8.length;f++){u=c.t8[f];l=c.p1.u1.scale;d=c.p1.u1.x-c.p1.v4.x*c.p1.u1.scale*width/2+l*u.x*width/2;p=c.p1.u1.y;l=u.s*l;k8(u.u6,l,d,p,c.clip,false);var g=u.u6.w*l*width/2;var m=-0;var w=d+g*(m||0);l=c.p1.u1.scale;l=u.s*l;var k=u.u6.cx*l*width/2;var y=u.u6.cw*l*width/2;d=w+k}if(c==a){var b=g4(a.p1.u1.y,a.p3.u1.y,r);b=height/2-v0.depth/v0.t6*g4(a.p1.v0.y,a.p3.v0.y,r)*height/2;var q=b;if(cars[0].u0>0){b-=cars[0].u0*v0.depth/v0.t6*height/2}var z=width/2;var x=g4(a.p1.u1.scale,a.p3.u1.scale,r);d=g4((a.p1.u1.x+a.p2.u1.x)/2,(a.p3.u1.x+a.p4.u1.x)/2,r)+x*cars[0].x*width/2;var I={v4:{x:u4.x,y:u4.y,z:u4.z},v0:{},u1:{}};v0.t7(I,0,a.index<t.index,width,height);z=I.u1.x;var j=0;if(u4.v9>0){if(u4.h8!=0){j=u4.h8}else{j=u4.s1?-1:u4.q6?1:0}}k7(v0.depth/v0.t6,z,b,j,a.p3.v4.y-a.p1.v4.y,q);if(race.state==4){t2.drawImage(v5.m6,-40,200,400,400)}}}}var Car=function(){var t=this;t.sprite=0;t.index=0;t.width=500;t.height=0;t.x=0;t.y=0;t.lastY=false;t.u0=0;t.z=0;t.lap=0;t.lapStarted=false;t.position=0;t.n4=.3;t.f2=[];t.c7=false;t.p9=0;t.h2=0;t.percent=0;t.v9=0;t.v1=0;t.v7StartTime=0;t.q2=t.v2=t.s1=t.q6=t.v7=t.l7=t.m3=false;t.m7=0;t.h8=0;t.o1=100;t.lapStarted=false;t.n4=.3;t.s4=26e3;t.i8=28e3;t.v9Percent=0;t.accel=6800;t.s9=-16e3;t.decel=-8e3;t.h5=0;t.lastLapTime=null;t.position=0;t.q9=3e3;t.slowOnCorners=false;t.c5=false;t.u7=1.5;t.g5=0};Car.prototype={l0:function(t,i,a){return t+i*a},b6:function(){this.f2=[];var t=400;var i=this.z+500;var a=t-40;var r=700;var e,s;var n=20;var h=0;if(this.c7===false){this.c7=[];for(e=0;e<n;e++){this.c7.push(r9())}}for(e=0;e<n;e++){this.c7[e]+=.03;if(this.c7[e]>=.8){this.c7[e]=0}var v=t+60;if(h>PI/6&&h<PI/2){v=t+60+(h-PI/6)*128}if(h>=PI/2&&h<5*PI/6){v=t+60+(5*PI/6-h)*128}var f=this.x+this.width/2+a*Math.cos(h-.05);var c=this.y+a*sin(h-.02);var o=this.x+this.width/2+a*Math.cos(h+.05);var u=this.y+a*sin(h+.02);var l=this.x+this.width/2+v*Math.cos(h-.05);var d=this.y+v*sin(h-.05);var p=this.x+this.width/2+v*Math.cos(h+.05);var x=this.y+v*sin(h+.05);var g=f+(l-f)*this.c7[e];var m=o+(p-o)*this.c7[e];var w=c+(d-c)*this.c7[e];var k=u+(x-u)*this.c7[e];var y=f+(l-f)*(this.c7[e]+.4);var b=o+(p-o)*(this.c7[e]+.4);var q=c+(d-c)*(this.c7[e]+.4);var z=u+(x-u)*(this.c7[e]+.4);var I=i-r*this.c7[e];var j=i-r*(this.c7[e]+.4);var T=[];T.push({v4:{x:g,y:w,z:I},v0:{},u1:{}});T.push({v4:{x:m,y:k,z:I},v0:{},u1:{}});T.push({v4:{x:b,y:z,z:j},v0:{},u1:{}});T.push({v4:{x:y,y:q,z:j},v0:{},u1:{}});this.f2.push(T);h+=PI/n}for(e=0;e<this.f2.length;e++){var M=this.f2[e];for(s=0;s<M.length;s++){v0.t7(M[s],0,0,width,height)}}},limit:function(t,i,a){return Math.max(i,Math.min(t,a))},t1:function(t,i,a,r,e){var s=t-(e-1)*i/2;var n=t+i*e;var h=a-(e-1)*r/2;var v=a+r*e;return!(n<h||s>v)},setTurnLeft:function(t){this.s1=t},m0:function(t){this.q6=t},j0:function(t){this.q2=t},r6:function(t){this.v2=t},s0:function(t){this.l7=t},setDrift:function(t){this.m3=t},d2:function(){return this.h5},getLap:function(){if(this.lap<1){return 1}return this.lap},n3:function(){var t=this.position,i=t%10,a=t%100;if(i==1&&a!=11){return t+"st"}if(i==2&&a!=12){return t+"nd"}if(i==3&&a!=13){return t+"rd"}return t+"th"},r7:function(){return this.v9},update:function(t){var i=this.s4;this.v9Percent=this.v9/this.s4;var a=v5.n1(this.z);var r=v5.n1(cars[0].z);var e=this.v9Percent;this.percent=b2(this.z,v3.t4Length);var s=t*this.q9*e;var n=a.p1.v4.x;var h=a.p2.v4.x;var v=this.x;var f=this.x+this.width;var c=v-n;var o=h-f;var u=h-n;var l=1;if(a.v6<0&&c>0){if(this.index==0){l=1+(u-this.width-c)*-a.v6/(u*80)}}else if(a.v6>0&&o>0){if(this.index==0){l=1+(u-this.width-o)*a.v6/(u*80)}}if(l<1){l=1}var d=.8;var p=1;if(this.h2>0){d+=.4}if(this.m3){if(this.v9>8e3){if(!this.v8&&!this.q2){this.m7=1.2;this.v8=true}}else{d-=.5;this.v8=false}}else{this.v8=false}if(this.m7>0&&this.v9>8e3){this.m7-=t;d-=.04;if(this.h8==0){if(this.s1){this.h8=-1}if(this.q6){this.h8=1}}}else{this.v8=false;this.m7=0;this.h8=0}var x=this.v7;if(this.l7){this.v7=this.o1>0&&this.v9>8e3&&this.q2}else{this.v7=false}if(this.v7){p=1.2;i=this.i8}this.u7=3.4;if(c<-this.width*.1||o<-this.width*.1){if(c+this.width*.1<-r.r3||o+this.width*.1<-r.r3){this.u7=9.5;d-=.6;p-=.2}else{d-=.1;this.u7=6}}this.u7=this.u7*r9()*e;if(this.index==0&&race.state!=5){this.x=this.x-s*e*r.v6*this.n4;if(this.h8!=0){s=s*.5}if(this.s1)this.x=this.x-s;else if(this.q6)this.x=this.x+s;var g=this.h8*this.v9*55e-5;this.x+=g;this.z=l1(this.z,t*this.v9*l,v5.r1());this.y=g4(a.p1.v4.y,a.p3.v4.y,this.percent);this.u0=0;if(this.q2){if(this.v7){var m=l6();if(!x){this.v7StartTime=m}this.o1-=t*2.45;b0(m-this.v7StartTime)}if(this.v9<i*d){this.v9=this.l0(this.v9,this.accel*p,t)}else{this.v9=this.l0(this.v9,this.decel,t);if(this.v9<i*d){this.v9=i*d}}}else if(this.v2){this.v9=this.l0(this.v9,this.s9,t)}else{this.v9=this.l0(this.v9,this.decel,t)}for(var w=0;w<r.t8.length;w++){var k=r.t8[w];var y=k.s*k.u6.cw;var b=k.x+k.u6.cx*k.s;var q=this.x;if(this.t1(q,this.width,b,y,1)){if(this.index==0){g8();this.p9=0;this.h2=0}this.v9=i/5;this.z=l1(r.p1.v4.z,0,v5.r1());break}}var z=false;for(var I=0;I<cars.length;I++){var j=cars[I].z-u4.z;if(u4.z>v5.r1()-1200){j-=v5.r1()}if(j>0&&j<1800){var T=(u4.x-cars[I].x)/cars[I].width;if(T<0){T=-T}if(T<.4){z=true}}}if(z&&this.v9>8e3){this.p9+=t*1;if(this.p9>.14){this.h2=2}}else{this.p9=0}if(this.h2>0){this.h2-=t}}else{if(this.v9<i){this.v9=this.l0(this.v9,this.accel,t)}var M=this.d1(a,r,u4.width);var C=this.x+M*s;if(a.v6==0){this.s1=M==-1;this.q6=M==1}else{this.s1=a.v6<-.5;this.q6=a.v6>.5}if(C+this.width<h*.6&&C>n*.8){this.x=C}this.z=l1(this.z,t*this.v9,v5.r1())}this.percent=b2(this.z,v3.t4Length);var L=v5.n1(this.z);if(this.index===0){for(w=0;w<L.cars.length;w++){var P=L.cars[w];if(P.index!=this.index){if(this.v9>P.v9){if(this.t1(this.x,this.width,P.x,P.width,1)){if(this.index!==0){this.v9=P.v9/2;if(P.index!==0){P.v9=P.v9*1.2}}else{if(this.index==0){g8();this.p9=0;this.h2=0}this.v9=P.v9;this.z=P.z-100}break}}}}}if(this.x+this.width/2<n-1.2*this.width){this.x=n-1.2*this.width-this.width/2}if(this.x+this.width/2>h+1.2*this.width){this.x=h+1.2*this.width-this.width/2}this.v9=this.limit(this.v9,0,i);if(this.index==0){b5(this.v9Percent)}if(a!=L){var S=a.cars.indexOf(this);a.cars.splice(S,1);L.cars.push(this)}if(this.z<v3.t4Length*1.2&&!this.lapStarted){this.lap++;this.lapStarted=true;this.lastLapTime=this.h5;if(this.lap==2&&this.index==0){speak("lap time "+this.d2().toFixed(2))}this.h5=0}else{if(this.z>v3.t4Length*1.2){this.lapStarted=false}this.h5+=t}var R=this.position;this.position=1;for(var I=0;I<cars.length;I++){if(I!=this.index){if(cars[I].lap>this.lap){this.position++}else if(cars[I].lap===this.lap){if(cars[I].z>this.z){this.position++}}}}if(this.index==0){if(this.e7>0){this.e7-=t}if(this.position!==R){this.newPosition=this.n3();this.e7=1}}if(this.index===0&&this.lap===3&&race.state!=5){this.g5=this.n3();speak("Race. Over.");speak(this.g5+" Place");this.v7=false;this.p9=0;this.h2=0;race.raceOver()}},d1:function(t,i,a){var r=60;var e=null;var s=v5.o8Count();for(var h=1;h<r;h++){e=v5.o8((t.index+h)%s);var v=e.p1.v4.x;var f=e.p2.v4.x;var c=0;if(h<8){for(n=0;n<e.cars.length;n++){var o=e.cars[n];var u=o.x;var l=o.width;var d=o.x+o.width;if(f-d<this.width*1.4){c=-1}else if(u-v<this.width*1.4){c=1}else{if(u-v>f-d){c=-1}else{c=1}}return c*3/h}}}if(this.c5){for(var h=1;h<r;h++){e=v5.o8((t.index+h)%s);var v=e.p1.v4.x;var f=e.p2.v4.x;if(e.v6>0){if(h<5){return 1/5}return 2/h}if(e.v6<0){if(h<5){return-1/5}return 2/h}}}return 0}};var e4="#a02222",g2="#BBBBBB",d4="#000000",g3="#000000",n9="#000000";var v3=function(){this.v5Length=0;this.m1=0;this.t4s=[];this.map=null};var q8=1200;v3.t4Length=300;var lanes=1;v3.prototype={buildv30:function(){q0=0;this.t4s=[];this.m9(200);this.e9()},createStreetLights:function(){var t=this.o8Count();for(var i=0;i<t;i++){var a=this.t4s[i];if(i%20==0){var r=a.p1.v4.x;a.t8.push({u6:a7,s:12,x:r-12*a7.w+700});var r=a.p2.v4.x;a.t8.push({u6:a5,s:12,x:r-700})}}},createRoadsideObjects:function(t,i,a,r,e){var s=this.o8Count();var n=0;for(var h=0;h<s;h++){var v=this.t4s[h];var f=r9();if(v.v6!=0&&e){if(n%20==0){if(v.v6>0){var c=v.p1.v4.x;v.t8.push({u6:d0,s:3,x:c-3*d0.w-400})}else{var c=v.p2.v4.x;v.t8.push({u6:d8,s:3,x:c+400})}}n++}else{n=0;var o=t[m8(t.length)];if(f>i){var c=v.p1.v4.x;v.t8.push({u6:o,s:a,x:c-a*o.w/2-r});var c=v.p2.v4.x;v.t8.push({u6:o,s:a,x:c-a*o.w/2+r})}}}},o3:function(){n9="#3a3a3a";d4="#047804",g3="#006A00";c6=p8;q0=0;j2();e5();createTrees();b1();a3();o6();var t=this;t.m9(50);t.g6(1,0);t.t3(50,50,39,0,40,0);t.g6(1,0);t.m9(25);t.g9(-1,0);t.g9(1,0);t.addHill(50,40);t.g6(1,0);t.g9(-1,0);t.g9(1,0);t.g6(1,-40);t.m9(50,-40);t.m9(55,0);t.e9();t.drawMap();t.createRoadsideObjects(k1,.9,10,900,true)},o2:function(){n9="#3a3a3a";d4="#047804";g3="#006A00";c6=p8;q0=0;j2();o6();e5();createTrees();b1();a3();j5();var t=this;t.m9(20);t.m9(46,0);t.g6(1,30);t.m9(90,0);t.d7(1,0);t.m9(25,0);t.d7(1,50);t.m9(25,0);t.d7(-1,0);t.m9(68,-50);t.d7(-1,0);t.d7(1,0);t.d7(1,0);t.m9(48,0);t.g6(1,-30);t.m9(38,0);t.g9(-1,0);t.g9(1,0);t.e9();t.drawMap();t.createRoadsideObjects([e8],.3,6,1300,true)},n8:function(){n9="#3a3a3a";d4="#5a5a5a";g3="#626262";c6=p8;q0=0;j2();o6();f8(false);c3(false);a4(false);var t=this;t.m9(100);t.d7(1,0);t.m9(151,0);t.h1(1,0);t.m9(30,0);t.h1(1,0);t.m9(80,0);t.d7(-1,0);t.d7(-1,0);t.m9(20,0);t.d7(1,0);t.m9(10,0);t.h1(1,0);t.m9(50,0);t.d7(-1,0);t.d7(1,0);t.d7(1,0);t.m9(62,0);t.e9();t.drawMap();t.createRoadsideObjects(c8,.95,20,3300,false);t.createStreetLights()},n6:function(){n9="#111111";c6="#555555";q0="#000000";d4="#090909";g3="#030303";j2();o6();f8(true);c3(true);a4(true);i0();var t=this;t.m9(100);t.addHardCurve180(1,0);t.h1(-1,0);t.m9(40,0);t.h1(1,0);t.h1(-1,0);t.h1(1,0);t.m9(50,0);t.d7(-1,0);t.m9(20,0);t.d7(1,0);t.h1(1,0);t.m9(60,0);t.d7(-1,0);t.d7(1,0);t.m9(51,0);t.h1(1,0);t.m9(110,0);t.e9();t.drawMap();t.createRoadsideObjects(c8,.95,20,3300,false);t.createStreetLights()},lastY:function(){return this.t4s.length==0?0:this.t4s[this.t4s.length-1].p3.v4.y},o8:function(t){return this.t4s[t]},o8Count:function(){return this.t4s.length},r1:function(){return this.v5Length},e9:function(){this.v5Length=v5.t4s.length*v3.t4Length},addSegment:function(t,i){var a=this.t4s.length;var r=this.lastY();var e=i;var s=a*v3.t4Length;var n=(a+1)*v3.t4Length;var h=-q8;var v=q8;var f=0;if(t!=0){f=t*40;if(f<0){f=-f}f+=60}this.t4s.push({index:a,p1:{v4:{x:h,y:r,z:s},v0:{},u1:{}},p2:{v4:{x:v,y:r,z:s},v0:{},u1:{}},p3:{v4:{x:v,y:e,z:n},v0:{},u1:{}},p4:{v4:{x:h,y:e,z:n},v0:{},u1:{}},v6:t,r3:f,t8:[],cars:[],color:false?u2.DARK:u2.LIGHT})},easeIn:function(t,i,a){return t+(i-t)*Math.pow(a,2)},easeOut:function(t,i,a){return t+(i-t)*(1-Math.pow(1-a,2))},easeInOut:function(t,i,a){return t+(i-t)*(-Math.cos(a*Math.PI)/2+.5)},t3:function(t,i,a,r,e,s){var s=s||0;var n=this.m1+s;var h=this.lastY();var v=h+Math.floor(e)*v3.t4Length;var f,c=t+i+a;var o=0;var u=0;var l=this.t4s.length;for(f=0;f<t;f++){o=this.easeIn(0,r,f/t);u+=o;this.addSegment(o,this.easeInOut(h,v,f/c))}for(f=0;f<i;f++){o=r;u+=o;this.addSegment(r,this.easeInOut(h,v,(t+f)/c))}for(f=0;f<a;f++){o=this.easeInOut(r,0,f/a);u+=o;this.addSegment(o,this.easeInOut(h,v,(t+i+f)/c))}var d=0;if(u!=0){d=(n-this.m1)/u}for(var p=l;p<this.t4s.length;p++){this.m1+=this.t4s[p].v6*d;this.t4s[p].angle=this.m1}this.m1=n;this.t4s[this.t4s.length-1].angle=n},m9:function(t,i){i=i||0;this.t3(t,t,t,0,i,0)},addBumps:function(){this.t3(10,10,10,0,5);this.t3(10,10,10,0,-2);this.t3(10,10,10,0,-5);this.t3(10,10,10,0,8);this.t3(10,10,10,0,5);this.t3(10,10,10,0,-7);this.t3(10,10,10,0,5);this.t3(10,10,10,0,-2)},g6:function(t,i){this.t3(25,100*1.4,25,t*4.25,i,t*90)},g9:function(t,i){this.t3(25,50,25,t*4.25,i,t*30)},d7:function(t,i){this.t3(25,50*1.5,25,t*6*.96,i,t*90)},h1:function(t){this.t3(18,50*.8,18,t*8,0,t*90)},addHardCurve180:function(){this.t3(50,50,50,7.5,0,180)},addHill:function(t,i){this.t3(t,t,t,0,i,0)},t3sideObject:function(t,i,a){var r=this.t4s[t];var e=0;if(a<0){e=r.p1.v4.x-600}else{e=r.p2.v4.x+600}r.t8.push({u6:i,x:e})},n1:function(t){return this.t4s[Math.floor(t/v3.t4Length)%this.t4s.length]},drawMap:function(){if(this.map==null){this.map=document.createElement("canvas")}this.map.width=600;this.map.height=600;cntx=this.map.getContext("2d");var t=canvas.width;var i=canvas.height;j7(600,600);g0("#666666");cntx.lineWidth=5;var a=0;var r=300;var e=30;k3();var s=.5;p0(r,e);for(var n=0;n<this.t4s.length;n++){a=this.t4s[n].angle/180*PI;r+=s*cos(a);e+=s*sin(a);o9(r,e);this.t4s[n].x=r;this.t4s[n].y=e}p2();g0(q5);cntx.lineWidth=4;p2();s=4;t2.lineWidth=3;g0(q5);k3();a=(this.t4s[0].angle+90)/180*PI;r-=s*cos(a);e-=s*sin(a);p0(r,e);r+=2*s*cos(a);e+=2*s*sin(a);o9(r,e);p2()},c9:function(){cntx=j1.x;this.m6=j1.c;j7(600,600);i5(this.map,0,0,600,600,0,0,600,600);for(var t=0;t<cars.length;t++){var i=cars[t].z;var a=v5.n1(i);k3();t9(a.x,a.y,5,0,2*PI,false);k4(r5);s2();cntx.lineWidth=2;g0("#999999");p2()}var r=cars[0].z;var e=v5.n1(r);k3();t9(e.x,e.y,5,0,2*PI,false);k4("#ff0000");s2();t2.lineWidth=2;g0(p8);p2()}};var v5=null;var numbers=["ONE","TWO","THREE","FOUR","FIVE","SIX","SEVEN","EIGHT"];var Race=function(){this.v5=null;this.state=0;this.f0=3;this.lastTime=0;this.r8=15;this.v5Number=0;this.zIsDown=false;this.xIsDown=false;this.raceNumber=0};Race.c4=800;Race.prototype={init:function(){},start:function(t){b5(0);if(t>=4){t=0}this.raceNumber=t;v5=new v3;switch(t){case 0:v5.o3();break;case 1:v5.o2();break;case 2:v5.n8();break;case 3:v5.n6();break}this.resetCars();u4=cars[0];u4.b6();this.state=0;this.f0=4;this.lastTime=l6()},raceOver:function(){this.state=5},keyDown:function(t){if(this.state!==5){switch(t.keyCode){case 90:this.zIsDown=true;u4.setDrift(true);break;case 88:this.xIsDown=true;u4.s0(true);break;case 38:u4.j0(true);break;case 40:u4.r6(true);break;case 37:u4.setTurnLeft(true);break;case 39:u4.m0(true);break}}else{}},keyUp:function(t){if(this.state!=5){switch(t.keyCode){case 90:this.zIsDown=false;u4.setDrift(false);break;case 88:this.xIsDown=false;u4.s0(false);break;case 38:u4.j0(false);break;case 40:u4.r6(false);break;case 37:u4.setTurnLeft(false);break;case 39:u4.m0(false);break}}else{if(t.keyCode==90){if(!this.zIsDown){this.start(this.raceNumber)}this.zIsDown=false}if(t.keyCode==88){if(!this.xIsDown){if(cars[0].g5=="1st"){this.start(this.raceNumber+1)}}this.xIsDown=false}}},resetCars:function(){cars=[];var t,i,a,r,e,s,n;for(var t=0;t<this.r8;t++){e=v5.r1()-(this.r8-t)*v3.t4Length*13;a=v5.n1(e);var h=a.p1.v4.x;var v=a.p2.v4.x;i=new Car;var f=0;if(t%2){f=h/2}else{f=v/2-i.width}i.index=t;i.x=f;i.z=e;i.sprite=s;i.v9=0;i.percent=b2(i.z,v3.t4Length);if(i.index!==0){var c=23e3;if(i.index<8&&i.index>3){i.s4=c*.905-r9()*(this.r8-t-1)*c/55}else if(i.index>12){i.s4=c*.905-(this.r8-t-1)*c/65}else{i.s4=c*.905-(this.r8-t-1)*c/45}i.accel=c/2;if(i.index<4){i.c5=false}else if(i.index<8){i.c5=r9()>.4;i.slowOnCorners=r9()>.6}}a.cars.push(i);cars.push(i)}},j3:function(t){var i=l6();if(i-this.lastTime>Race.c4){this.lastTime=l6();this.f0--;if(this.f0==3){speak("RACE")}if(this.f0==2){speak(numbers[this.raceNumber])}if(this.f0<=0){this.state=1;this.f0=3;i7(220,1/4)}}v0.update(t)},f9:function(t){var i=l6();if(i-this.lastTime>Race.c4){this.lastTime=l6();this.f0--;if(this.f0<=0){i7(440,1/2);this.state=4}else{i7(220,1/4)}}v0.update(t)},updateRace:function(t){var i=v5.n1(u4.z);var a=u4.v9Percent;var r=t*2*a;var e=v0.z;for(var s=0;s<cars.length;s++){cars[s].update(t)}v0.update(t);h3=l1(h3,i2*i.v6*(v0.z-e)/v3.t4Length,1);h4=l1(h4,i3*i.v6*(v0.z-e)/v3.t4Length,1);h6=l1(h6,i4*i.v6*(v0.z-e)/v3.t4Length,1)},h7:function(){},update:function(t){switch(this.state){case 0:this.j3(t);break;case 1:this.f9(t);break;case 5:case 4:this.updateRace(t);break}},render:function(){l9();if(this.state==0){t2.font="italic bold 350px "+q7;if(this.f0<4){k4(r5);l2("RACE",14,304);k4(q5);l2("RACE",10,300)}if(this.f0<3){if(this.raceNumber==0){t2.font="italic bold 440px "+q7}else if(this.raceNumber==1){t2.font="italic bold 430px "+q7}else if(this.raceNumber==2){t2.font="italic bold 290px "+q7}else if(this.raceNumber==3){t2.font="italic bold 358px "+q7}k4(r5);l2(numbers[this.raceNumber],14,674);k4(q5);l2(numbers[this.raceNumber],10,670)}}if(this.state==1){t2.font=" 300px "+q7;t2.fillStyle="#111111";t2.fillText(this.f0,449,254);t2.fillStyle=q5;t2.fillText(this.f0,445,250)}if(this.state==4){k4(q5);g0(q5);t2.font=" 80px "+q7;t2.fillText(u4.n3(),10,80);t2.font=" 40px "+q7;t2.fillText("Lap "+u4.getLap()+" of 2",10,130);t2.fillText("Lap Time: "+u4.d2().toFixed(2),10,180);t2.font=" 80px "+q7;var t=("000"+Math.round(u4.r7()/100).toString(10)).substr(-3);t2.fillText(t+"km/h",695,80);t2.font=" 40px "+q7;t2.fillText("Turbo ",670,136);k3();t2.rect(796,110,208,28);p2();m2(800,114,u4.o1*2,20);if(cars[0].e7>0){t2.font=" 160px "+q7;k4(q5);t2.fillText(cars[0].n3(),334,184)}}if(this.state==5){t2.font=" 300px "+q7;k4(q5);t2.fillText(cars[0].g5,300,290);t2.font=" 40px "+q7;var i=380;if(cars[0].g5=="1st"){t2.fillText("x: Next Race",397,i);i+=80}t2.fillText("z: Retry",445,i)}}};var canvas=document.getElementById("gameCanvas");var t2=canvas.getContext("2d");var u8=false;var l6=function(){return performance.now()};document.addEventListener("keydown",function(t){if(u8){race.keyDown(t)}else{m4.keyDown(t)}});document.addEventListener("keyup",function(t){if(u8){race.keyUp(t)}else{m4.keyUp(t)}});var now=l6();var last=l6();var dt=0;var gdt=0;var cars=[];var u4=null;var v0=new u3;var race=new Race;v5=new v3;var m4=new m5(canvas,t2);function startGame(t){i6();speak("Start");u8=true;v0.reset();race.start(0)}m4.init();function frame(){now=l6();dt=Math.min(1,(now-last)/1e3);gdt=gdt+dt;if(!u8){m4.render(dt);gdt=0}else{n2=false;var t=1/180;while(gdt>t){gdt=gdt-t;race.update(t)}v5.c9();race.render();last=now}requestAnimationFrame(frame)}frame();var r4=null;var n7=null;var f6=null;var f5=null;var d5=0;var f4=0;var d6=1;var f3=1;var f7=[];var g7=[];function b0(t){f3=1+t/1e4}function i6(){if(r4==null){r4=new(window.AudioContext||window.webkitAudioContext);a0();a1();a2();f6=r4.createScriptProcessor(1024);f6.onaudioprocess=function(t){var i=t.outputBuffer.getChannelData(0);var a;for(var r=0;r<i.length;++r){if(u4.v7){d5+=d6+Math.random();f4+=f3;a=Math.floor(f4)%g7.length;i[r]=g7[a];a=Math.floor(d5)%f7.length;i[r]+=f7[a]+Math.random()*.01}else{d5+=d6+Math.random()*1;a=Math.floor(d5)%f7.length;i[r]=f7[a]+Math.random()*.01}if(u4.h2>0){i[r]+=Math.random()*.4}}d5%=f7.length;f4%=g7.length};f5=r4.createGain();f5.gain.value=.14;f6.connect(f5);f5.connect(r4.destination)}}function a1(){var t=1024;g7=[];var i=0;for(var a=0;a<t;a++){for(var r=0;r<12;r++){g7[i++]=Math.random()*.01;if(i>=t){break}}var e=.2;if(i<t){for(var s=0;s<2;s++){g7[i++]=e;if(i>=t){break}}}}for(var a=0;a<t;a++){g7[a]+=Math.random()*.5-.05}}function a0(){var t=1024;f7=[];var i=1;var a,r;var e=0;f7[e++]=1;for(var s=.05;s<1;s+=Math.random()/8+.01){r=Math.floor(s*t);a=Math.random()*2-1;var n=r-(e-1);var h=(a-i)/n;for(var v=0;v<n;v++){f7[e++]=i+h*v}i=a}n=t-(e-1);var h=(1-i)/n;for(var v=0;v<n;v++){f7[e++]=i+h*v}}function a2(){var t=2*r4.sampleRate;n7=r4.createBuffer(1,t,r4.sampleRate);var i=n7.getChannelData(0);for(var a=0;a<t;a++){i[a]=Math.random()*2-1}}function i7(t,i){var a=r4.createGain();var r=r4.createOscillator();r.connect(a);a.connect(r4.destination);r.type="triangle";r.frequency.value=t;a.gain.value=.1;r.start(r4.currentTime);r.stop(r4.currentTime+i)}function b5(t){d6=.2+t*2}function b8(){}var i1=0;function g8(){var t=l6();if(t-i1<1e3){return}i1=t;var i=1/2;var a=r4.createGain();var r=null;r=r4.createBufferSource();r.connect(a);a.connect(r4.destination);r.buffer=n7;a.gain.linearRampToValueAtTime(.5,r4.currentTime);a.gain.linearRampToValueAtTime(0,r4.currentTime+i*.7);r.playbackRate.setValueAtTime(.035,r4.currentTime);r.playbackRate.setValueAtTime(.002,r4.currentTime+i);r.start(r4.currentTime);r.stop(r4.currentTime+i)}var i9="";function speak(t){var i=window.speechSynthesis.getVoices();if(i9==""){for(var a=0;a<i.length;a++){if(i[a].lang==="en-GB"){i9=i[a];break}}if(i9===""&&i.length>0){i9=i[0]}}var r=new SpeechSynthesisUtterance;r.text=t;if(i9!=""){r.voice=i9}window.speechSynthesis.speak(r)}